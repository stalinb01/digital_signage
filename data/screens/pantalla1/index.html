<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pantalla 1 - Digital Signage</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        .slide-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .slide.active {
            opacity: 1;
            z-index: 10;
        }
        
        .slide.fade-out {
            opacity: 0;
        }
        
        /* Transición Fade */
        .transition-fade {
            transition: opacity 1s ease-in-out;
        }
        
        /* Transición Slide */
        .transition-slide {
            transition: transform 1s ease-in-out, opacity 1s ease-in-out;
        }
        
        .transition-slide.slide-in {
            transform: translateX(0);
            opacity: 1;
        }
        
        .transition-slide.slide-out {
            transform: translateX(-100%);
            opacity: 0;
        }
        
        /* Transición Zoom */
        .transition-zoom {
            transition: transform 1.5s ease-in-out, opacity 1s ease-in-out;
        }
        
        .transition-zoom.active {
            transform: scale(1);
        }
        
        .transition-zoom.zoom-out {
            transform: scale(1.2);
            opacity: 0;
        }
        
        .slide img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .slide video {
            width: 100vw;
            height: 100vh;
            object-fit: contain;
            background: #000;
        }
        
        .slide iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .slide [id^="playerContainer-"] {
            width: 100%;
            height: 100%;
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            z-index: 1000;
        }
        .admin-nav {
            background: #333;
            color: white;
            padding: 10px 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-container h1 {
            font-size: 1.2rem;
            margin: 0;
        }

        .btn-logout {
            background-color: #e74c3c;
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .btn-logout:hover {
            background-color: #c0392b;
        }
        
    </style>
</head>
<body>
    <div class="loading" id="loading">Cargando presentación...</div>
    <div class="slide-container" id="slideContainer"></div>
    
    <script>
        const slides = [{"duration": 7, "id": "slide_1769139392873_ox8c3pgw6", "transition": "fade", "type": "image", "url": "/static/uploads/20260122_223633_1.png"}, {"duration": 2, "id": "slide_1769139447475_ld2nha83b", "transition": "fade", "type": "image", "url": "/static/uploads/20260122_223727_4.png"}, {"duration": 2, "id": "slide_1769139473172_sccqbcevq", "transition": "zoom", "type": "image", "url": "/static/uploads/20260122_223753_3.png"}, {"duration": 10, "id": "slide_1769182891706_y1l1m6cu2", "transition": "slide", "type": "video", "url": "/static/uploads/20260123_104132_demo_casamanilla.mp4"}, {"duration": 101, "id": "slide_1769183663443_0h7hkjsde", "transition": "slide", "type": "youtube", "video_id": "Mv5jSF5jYcI"}];
        let currentSlideIndex = 0;
        let slideTimeout;
        let isTransitioning = false;
        
 function createSlideElement(slide, index) {
            const div = document.createElement('div');
            div.className = 'slide';
            div.id = 'slide-' + index;

            if (slide.type === 'image') {
                const img = document.createElement('img');
                img.src = slide.url;
                div.appendChild(img);
            } 
            else if (slide.type === 'video') {
                const video = document.createElement('video');
                video.src = slide.url;
                video.autoplay = true;
                video.muted = true;
                video.loop = true;
                div.appendChild(video);
            }
            else if (slide.type === 'youtube') {
                const iframe = document.createElement('iframe');
                // URL corregida para evitar el "undefined"
                const vId = slide.video_id;
                iframe.src = `https://www.youtube.com/embed/${vId}?autoplay=1&mute=1&controls=0&loop=1&playlist=${vId}`;
                iframe.allow = 'autoplay; encrypted-media';
                div.appendChild(iframe);
            }
            return div;
        }
        
        function initSlides() {
            const container = document.getElementById('slideContainer');
            slides.forEach((slide, index) => {
                const slideElement = createSlideElement(slide, index);
                container.appendChild(slideElement);
            });
            
            document.getElementById('loading').style.display = 'none';
            
            if (slides.length > 0) {
                showSlide(0);
            }
        }
        
        function showSlide(index) {
            if (isTransitioning || slides.length === 0) return;
            
            isTransitioning = true;
            const allSlides = document.querySelectorAll('.slide');
            const currentSlide = allSlides[currentSlideIndex];
            const nextSlide = allSlides[index];
            const transition = slides[index].transition || 'fade';
            
            // Limpiar slide actual
            if (currentSlide) {
                // Detener video si existe
                const videoId = currentSlide.getAttribute('data-video-id');
                if (videoId) {
                    const video = document.getElementById(videoId);
                    if (video) {
                        video.pause();
                        video.currentTime = 0;
                    }
                }
                
                // Limpiar YouTube si existe
                const youtubeId = currentSlide.getAttribute('data-youtube-id');
                if (youtubeId) {
                    const container = currentSlide.querySelector('[id^="playerContainer-"]');
                    if (container) {
                        container.innerHTML = '';
                    }
                }
                
                // Aplicar transición de salida
                if (transition === 'slide') {
                    currentSlide.classList.add('slide-exiting');
                } else if (transition === 'zoom') {
                    currentSlide.classList.add('zoom-exiting');
                } else {
                    currentSlide.classList.add('fade-out');
                }
            }
            
            // Mostrar siguiente slide
            setTimeout(() => {
                // Limpiar slide anterior
                if (currentSlide) {
                    currentSlide.classList.remove('active', 'slide-exiting', 'zoom-exiting', 'fade-out');
                }
                
                // Preparar entrada del nuevo slide
                if (transition === 'slide') {
                    nextSlide.classList.add('slide-entering');
                } else if (transition === 'zoom') {
                    nextSlide.classList.add('zoom-entering');
                }
                
                // Activar slide
                nextSlide.classList.add('active');
                
                // Animar entrada
                setTimeout(() => {
                    nextSlide.classList.remove('slide-entering', 'zoom-entering');
                    currentSlideIndex = index;
                    isTransitioning = false;
                    
                    // Manejar contenido del nuevo slide
                    const youtubeId = nextSlide.getAttribute('data-youtube-id');
                    const videoId = nextSlide.getAttribute('data-video-id');
                    
                    if (youtubeId) {
                        // Cargar YouTube con tu script
                        const container = nextSlide.querySelector('[id^="playerContainer-"]');
                        if (container) {
                            const ancho = window.innerWidth;
                            const alto = window.innerHeight;
                            
                            const iframe = document.createElement('iframe');
                            iframe.id = `ytPlayer-${index}`;
                            iframe.width = ancho;
                            iframe.height = alto;
                            iframe.src = `https://www.youtube.com/embed/${youtubeId}?autoplay=1&mute=1&rel=0&origin=${window.location.origin}`;
                            iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen";
                            iframe.setAttribute('allowfullscreen', '');
                            
                            container.appendChild(iframe);
                        }
                        
                        // Programar siguiente slide
                        clearTimeout(slideTimeout);
                        slideTimeout = setTimeout(() => {
                            const nextIndex = (currentSlideIndex + 1) % slides.length;
                            showSlide(nextIndex);
                        }, slides[index].duration * 1000);
                        
                    } else if (videoId) {
                        // Reproducir video local
                        const video = document.getElementById(videoId);
                        if (video) {
                            video.currentTime = 0;
                            const playPromise = video.play();
                            
                            if (playPromise !== undefined) {
                                playPromise.then(() => {
                                    console.log('Video reproduciendo');
                                }).catch(err => {
                                    console.error('Error reproduciendo video:', err);
                                    setTimeout(() => video.play(), 200);
                                });
                            }
                            
                            // Programar siguiente slide
                            clearTimeout(slideTimeout);
                            slideTimeout = setTimeout(() => {
                                video.pause();
                                const nextIndex = (currentSlideIndex + 1) % slides.length;
                                showSlide(nextIndex);
                            }, slides[index].duration * 1000);
                        }
                    } else {
                        // Imagen - programar siguiente slide
                        clearTimeout(slideTimeout);
                        slideTimeout = setTimeout(() => {
                            const nextIndex = (currentSlideIndex + 1) % slides.length;
                            showSlide(nextIndex);
                        }, slides[index].duration * 1000);
                    }
                }, 50);
            }, transition === 'fade' ? 500 : 800);
        }
        
        // Iniciar presentación
        window.addEventListener('load', () => {
            initSlides();
        });
        
        // Re-ajustar iframes de YouTube al redimensionar
        window.addEventListener('resize', () => {
            document.querySelectorAll('[id^="ytPlayer-"]').forEach(iframe => {
                iframe.width = window.innerWidth;
                iframe.height = window.innerHeight;
            });
        });
        
        // Detener transiciones al salir
        window.addEventListener('beforeunload', () => {
            clearTimeout(slideTimeout);
        });
    </script>
</body>
</html>